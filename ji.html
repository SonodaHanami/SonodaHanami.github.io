<html>

<head>
    <title>肉鸽计算器</title>
    <style>
        @font-face {
            font-family: 'LESLIE';
            src: url('LESLIE.ttf') format('truetype');
        }

        @font-face {
            font-family: 'Sarasa';
            src: url('sarasa-mono-sc-regular.ttf') format('truetype');
        }
        body {
            padding-top: 10px;
            padding-left: 10px;
            padding-right: 10px;
            /* color: rgb(255, 255, 255); */
            color: rgb(255, 0, 0);
            font-family: Sarasa;
            font-size: 32px;
            font-weight: bold;
            text-align: center;
            /* -webkit-text-stroke: #ffffff7f 0.25px; */
        }

        .text {
            width: 100%;
            font-size: 32px;
            font-weight: bold;
        }

        .text tr {
            height: 40px;
        }

        .panel {
            width: 100%;
        }

        .panel tr td {
            width: 25%;
        }

        .panel tr td input {
            height: 40px;
            width: 100%;
        }
        .subtitle {
            float: left;
        }

        .score {
            text-align: right;
            font-family: LESLIE;
            font-size: 48px;
            float: right;
        }
    </style>
</head>

<body>
    <table class="text">
        <tr>
            <td>总分：</td>
            <td class="score" id="text_total_score">0</td>
        </tr>
        <tr>
            <td>原始分：</td>
            <td class="score" id="text_basic_score">0</td>
        </tr>
        <tr>
            <td>难度：</td>
            <td class="score" id="text_level">0</td>
        </tr>
        <tr>
            <td>倍率：</td>
            <td class="score" id="text_multi">1.00</td>
        </tr>
        <tr>
            <td>额外加分：</td>
            <td class="score" id="text_bonus_score">0</td>
        </tr>
        <tr>
            <td colspan="2" rowspan="4" >
                额外加分项： <span id="text_bonus">无</span>
            </td>
        </tr>
        <tr><td></td></tr>
        <tr><td></td></tr>
        <tr><td></td></tr>
    </table>
    <table class="panel" border="0" cellspacing="1">
        <tr>
            <td>
                <input type="submit" value="骑士" onclick="func_click('骑士')">
            </td>
            <td>
                <input type="submit" value="蒂蒂" onclick="func_click('蒂蒂')">
            </td>
            <td>
                <input type="submit" value="墓碑/寒灾" onclick="func_click('墓碑/寒灾')">
            </td>
            <td>
                <input type="submit" value="锈锤" onclick="func_click('锈锤')">
            </td>
        </tr>
        <tr>
            <td>
                <input type="submit" value="紧急领地意识" onclick="func_click('紧急领地意识')">
            </td>
            <td>
                <input type="submit" value="紧急狩猎场" onclick="func_click('紧急狩猎场')">
            </td>
            <td>
                <input type="submit" value="紧急失控" onclick="func_click('紧急失控')">
            </td>
            <td>
                <input type="submit" value="紧急育生池" onclick="func_click('紧急育生池')">
            </td>
        </tr>
        <tr>
            <td>
                <input type="submit" value="紧急好梦在何方" onclick="func_click('紧急好梦在何方')">
            </td>
            <td>
                <input type="submit" value="紧急机械之灾" onclick="func_click('紧急机械之灾')">
            </td>
            <td>
                <input type="submit" value="紧急深度认知" onclick="func_click('紧急深度认知')">
            </td>
            <td>
                <input type="submit" value="紧急水火相容" onclick="func_click('紧急水火相容')">
            </td>
        </tr>
        <tr>
            <td>
                <input type="submit" value="监工现场杀鸭" onclick="func_click('监工现场杀鸭')">
            </td>
            <td>
                <input type="submit" value="真相" onclick="func_click('真相')">
            </td>
            <td>
                <input type="submit" value="跳舞" onclick="func_click('跳舞')">
            </td>
            <td>
                <input type="submit" value="跳舞无漏" onclick="func_click('跳舞无漏')">
            </td>
        </tr>
        <tr>
            <td>
                <input type="submit" value="鸭本运作" onclick="func_click('鸭本运作')">
            </td>
            <td>
                <input type="submit" value="狂信如火" onclick="func_click('狂信如火')">
            </td>
            <td colspan="2">
                <input type="submit" value="竭泽而渔/图穷匕见" onclick="func_click('竭泽而渔/图穷匕见')">
            </td>
        </tr>
        <tr>
            <td>
                <input type="submit" value="鸭/熊" onclick="func_click('鸭/熊')">
            </td>
            <td>
                <input type="submit" value="狗" onclick="func_click('狗')">
            </td>
        </tr>
        <tr>
            <td>难度：<input type="number" value="0" id="level" min="0" max="15"></td>
            <td>原始分：<input type="number" value="0" id="basic_score" min="0"></td>
            <td>干员：<input type="number" value="0" id="operator" min="0"></td>
            <td>藏品：<input type="number" value="0" id="item" min="0"></td>
        </tr>
        <tr></tr>
        <tr>
            <td></td>
            <td>
                <input type="submit" value="清空" onclick="func_click('清空')">
            </td>
            <td>
                <input type="submit" value="撤销" onclick="func_click('撤销')">
            </td>
            <td>
                <input type="submit" value="计算" onclick="func_click('计算')">
            </td>
        </tr>
        <tr></tr>
    </table>

    <script>
        bonus_item = {
            "骑士": 350,
            "蒂蒂": 80,
            "墓碑/寒灾": 60,
            "锈锤": 50,
            "紧急领地意识": 30,
            "紧急狩猎场": 20,
            "紧急失控": 50,
            "紧急育生池": 30,
            "紧急好梦在何方": 30,
            "紧急机械之灾": 15,
            "紧急深度认知": 60,
            "紧急水火相容": 40,
            "监工现场杀鸭": 20,
            "真相": 20,
            "跳舞": 15,
            "跳舞无漏": 30,
            "鸭本运作": 20,
            "狂信如火": 20,
            "竭泽而渔/图穷匕见": 20,
            "鸭/熊": 20,
            "狗": 15,
        }

        current_bonus = [];
        current_bonus_score = [];
        
        function sum_bonus_score() {
            console.log(current_bonus_score)
            result = 0;
            for (var i = 0; i < current_bonus_score.length; i++){
                result += parseInt(current_bonus_score[i]);
            }
            return result;
        }

        function draw() {
            basic_score = parseInt(document.getElementById("basic_score").value);
            document.getElementById("text_basic_score").innerHTML = basic_score;
            level = parseInt(document.getElementById("level").value);
            multi = level == 15 ? 1.8 : 1 + 0.05 * level;
            document.getElementById("text_level").innerHTML = level;
            document.getElementById("text_multi").innerHTML = multi.toFixed(2);
            document.getElementById("text_bonus_score").innerHTML = sum_bonus_score();
            if (current_bonus.length > 0) {
                document.getElementById("text_bonus").innerHTML = current_bonus.join(', ');
            }
            else {
                document.getElementById("text_bonus").innerHTML = '无';
            }
            
        }

        function clear() {
            current_bonus = [];
            current_bonus_score = [];
            document.getElementById("text_total_score").innerHTML = 0;
            document.getElementById("text_basic_score").innerHTML = 0;
            document.getElementById("text_level").innerHTML = 0;
            document.getElementById("text_level").innerHTML = '1.00';
            document.getElementById("level").value = 0;
            document.getElementById("basic_score").value = 0;
            document.getElementById("operator").value = 0;
            document.getElementById("item").value = 0;
        }

        function undo() {
            if (current_bonus.length > 0) {
                current_bonus.pop();
                undo_score = current_bonus_score.pop();
                document.getElementById("text_bonus_score").innerHTML = sum_bonus_score();
            }
        }

        function solve() {
            current_bonus.push(`干员×${operator.value}`);
            current_bonus_score.push(operator.value * 10);
            current_bonus.push(`藏品×${item.value}`);
            current_bonus_score.push(item.value * 10);
            basic_score = parseInt(document.getElementById("basic_score").value);
            level = parseInt(document.getElementById("level").value);
            multi = level == 15 ? 1.8 : 1 + 0.05 * level;
            document.getElementById("text_bonus_score").innerHTML = sum_bonus_score();
            document.getElementById("text_total_score").innerHTML = Math.round(
                basic_score * multi + sum_bonus_score()
            );
        }

        function func_click(target) {
            console.log(target);
            if (target == '清空') {
                clear();
            }
            else if (target == '撤销') {
                undo();
            }
            else if (target == '计算') {
                solve();
            }
            else {
                current_bonus.push(target);
                current_bonus_score.push(bonus_item[target] ? bonus_item[target] : 0);
            }
            draw();
        }


        document.onclick = () => draw();
    </script>
</body>
<html>